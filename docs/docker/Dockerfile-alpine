FROM nginx:alpine-perl
WORKDIR /app

# 安装必要的运行时依赖 - 使用 Alpine 的 apk 包管理器
RUN apk update && \
    apk add --no-cache ca-certificates tzdata && \
    rm -rf /var/cache/apk/*

# 设置时区
ENV TZ=Asia/Shanghai

# 设置默认环境变量
ENV DB_PATH=/app/data/database.db
ENV ASSETS_PATH=/app/data/assets

# 保持原始目录结构
COPY frontend /app/frontend
COPY gobackend /app/gobackend

# 复制启动脚本
COPY start.sh /app/
RUN chmod +x /app/start.sh

# 创建必要的目录
RUN mkdir -p /app/data

# 暴露端口
EXPOSE 80 443

# 设置卷挂载点
VOLUME ["/app/data"]

# 设置启动命令
CMD ["/app/start.sh"]
